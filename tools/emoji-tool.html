<script>
/* ================= CORE LOGIC ================= */

const grid = document.getElementById("emojiGrid");
const search = document.getElementById("emojiSearch");
const toast = document.getElementById("toast");
const tabs = document.querySelectorAll(".tab");
const cats = document.querySelectorAll(".cat");
const toneSel = document.getElementById("tone");

let currentTab="all", currentCat="all", skinTone="";

const catRanges={
  smileys:[[0x1F600,0x1F64F]],
  animals:[[0x1F400,0x1F43F]],
  food:[[0x1F347,0x1F37F]],
  activities:[[0x26BD,0x1F3C0]],
  objects:[[0x1F4A0,0x1F52F]],
  hearts:[[0x2764,0x2764]],
  hands:[[0x1F44B,0x1F64F]]
};

/* ğŸŒ COUNTRY CODE â†’ NAME */
const countryMap = {
 US:"United States", GB:"United Kingdom", IN:"India", PK:"Pakistan",
 AE:"United Arab Emirates", SA:"Saudi Arabia", CN:"China", JP:"Japan",
 KR:"South Korea", DE:"Germany", FR:"France", IT:"Italy", ES:"Spain",
 CA:"Canada", AU:"Australia", BR:"Brazil", RU:"Russia", TR:"Turkey",
 ID:"Indonesia", MY:"Malaysia", TH:"Thailand", VN:"Vietnam",
 PH:"Philippines", BD:"Bangladesh", LK:"Sri Lanka", NP:"Nepal",
 IR:"Iran", IQ:"Iraq", EG:"Egypt", ZA:"South Africa", NG:"Nigeria",
 MX:"Mexico", NL:"Netherlands", SE:"Sweden", NO:"Norway", FI:"Finland",
 DK:"Denmark", PL:"Poland", UA:"Ukraine", AT:"Austria", CH:"Switzerland",
 BE:"Belgium", PT:"Portugal", GR:"Greece", IL:"Israel", QA:"Qatar",
 KW:"Kuwait", OM:"Oman", NZ:"New Zealand", SG:"Singapore",
 HK:"Hong Kong", TW:"Taiwan"
};

/* âœ… CORRECT FLAG GENERATOR */
function codeToFlag(code){
  return [...code].map(c =>
    String.fromCodePoint(127397 + c.charCodeAt())
  ).join("");
}

/* FLAGS AS OBJECTS (IMPORTANT FIX) */
const flagList = Object.entries(countryMap).map(([code,name])=>({
  emoji: codeToFlag(code),
  name: name.toLowerCase()
}));

/* TRENDING EMOJIS */
const trendingEmojis=["ğŸšš","ğŸª","âš ï¸","ğŸ›’","ğŸ›ï¸","ğŸ’³","ğŸ“¦","ğŸ“¢","ğŸ”¥","â¤ï¸","ğŸš¨","ğŸ†˜"];

let emojis=[...trendingEmojis];
Object.values(catRanges).flat().forEach(r=>{
  for(let i=r[0];i<=r[1];i++) emojis.push(String.fromCodePoint(i));
});

/* ===== LAZY RENDER ===== */
let renderIndex=0,pageSize=50;

function render(reset=true){
  if(reset){grid.innerHTML="";renderIndex=0;}
  let list=[];

  if(currentCat==="flags"){
    const q=search.value.toLowerCase();
    list = flagList.filter(f=>f.name.includes(q));
  }else{
    list=[...emojis];
    if(search.value) list=list.filter(e=>e.includes(search.value));
  }

  list.slice(renderIndex,renderIndex+pageSize).forEach(item=>{
    const s=document.createElement("span");
    s.className="emoji";

    if(typeof item==="object"){
      s.innerHTML=item.emoji;
      s.dataset.country=item.name;
      s.onclick=()=>navigator.clipboard.writeText(item.emoji);
    }else{
      s.innerHTML=item;
      s.onclick=()=>navigator.clipboard.writeText(item);
    }

    s.onclick=()=>{
      navigator.clipboard.writeText(
        typeof item==="object"?item.emoji:item
      );
      toast.style.display="block";
      setTimeout(()=>toast.style.display="none",600);
    };

    grid.appendChild(s);
  });

  renderIndex+=pageSize;
}

/* EVENTS */
tabs.forEach(t=>t.onclick=()=>{
  tabs.forEach(x=>x.classList.remove("active"));
  t.classList.add("active");
  currentTab=t.dataset.tab;
  render();
});

cats.forEach(c=>c.onclick=()=>{
  cats.forEach(x=>x.classList.remove("active"));
  c.classList.add("active");
  currentCat=c.dataset.cat;
  render();
});

search.oninput=()=>render();
render();
</script>
